<!-- https://olivierpieters.be/blog/2016/02/26/creating-a-jekyll-image-gallery -->
<div id="image-gallery{% if include.id_number %}-{{ include.id_number }}{% endif %}" class="image-gallery">

  <div id="gallery-sizer{% if include.id_number %}-{{ include.id_number }}{% endif %}" class="gallery-sizer"></div>

  {% for picture in include.gallery.pictures %}
  <div class="image-wrapper">

    <a href="{{ picture.original }}" class="image"

      {% if picture.title %} 
        data-sub-html=
          "
            <h4>{{ picture.title | escape }}</h4>
              {% if picture.caption %}
                <p>{{ picture.caption | escape }}</p>
              {% endif %}
          "
      {% endif %}> 
    
      <img alt="{{ picture.title }}" src="{{ picture.thumbnail }}" />

    </a>

  </div>
  {% endfor %}

</div>

<script type="text/javascript">

  var grid = document.getElementById('image-gallery{% if include.id_number %}-{{ include.id_number }}{% endif %}');

  var grid{% if include.id_number %}{{ include.id_number }}{% endif %} = new Isotope(grid, {
    //'.' prepends css class
    itemSelector : '.image-wrapper',
    percentPosition : true,
    masonry: {
      columnWidth : document.getElementById('gallery-sizer{% if include.id_number %}-{{ include.id_number }}{% endif %}')
      //should either be a Selector String or Element object
      //columnWidth : 'gallery-sizer{% if include.id_number %}-{{ include.id_number }}{% endif %}'
    }
  });

  function isotopelayoutWrapper()
  {
    grid{% if include.id_number %}{{ include.id_number }}{% endif %}.layout();
    console.log('loaded and layout refreshed');
  }

  var imgWrappers = grid.querySelectorAll('.image-wrapper');
  imgWrappers.forEach(function(imgwrapper){
    var img = imgwrapper.querySelector('img');
    console.log('attached');
    if(img.complete)
      isotopelayoutWrapper();
    else
      img.addEventListener('load', isotopelayoutWrapper);
  })

</script>

<script type="text/javascript">

  elm = document.getElementById("image-gallery{% if include.id_number %}-{{ include.id_number }}{% endif %}");

  var lg{% if include.id_number %}{{ include.id_number }}{% endif %} = lightGallery(document.getElementById("image-gallery{% if include.id_number %}-{{ include.id_number }}{% endif %}"), {
    plugins: [lgHash],
    thumbnail: true,
    selector: '.image',
    //https://www.lightgalleryjs.com/demos/hash/
    galleryId: {% if include.id_number %}{{ include.id_number }}{% endif %}
  });

  // elm.addEventListener('lgBeforeOpen', function(event) {
  //   console.log('before');
  //   console.log(window.location.href);
  // });

  //#1 if sent from the page other than its parent(origin + pathname + search?), we could decide on pressing the back button to either
  //#1-1 point back to where it came from; should it turn off the browser in mobile?
  //#1-2 turn off the lightGallery and point back to url with stripped hash
  elm.addEventListener('lgAfterOpen', function(event) {
    var baseUrl = window.location.href.split('#')[0];
    //console.log(baseUrl);
    history;
    //https://developer.mozilla.org/en-US/docs/Web/API/History/pushState
    //Whenever the user navigates to the new state, a popstate event is fired, and the state property of the event contains a copy of the history entry's state object.
    history.pushState(null, "", baseUrl);
    //when refreshed w/ lightGallery on, 
    //'lgAfterOpen' returns URL before lgHash plugin hashes its URL
    //console.log(window.location.href);
  });

  // gallery{% if include.id_number %}{{ include.id_number }}{% endif %}.click(function() {});

</script>
 



