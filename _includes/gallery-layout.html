<!-- https://olivierpieters.be/blog/2016/02/26/creating-a-jekyll-image-gallery -->
<div id="image-gallery{% if include.id_number %}-{{ include.id_number }}{% endif %}" class="image-gallery">

  <div id="gallery-sizer{% if include.id_number %}-{{ include.id_number }}{% endif %}" class="gallery-sizer"></div>

  {% for picture in include.gallery.pictures %}
  <div class="image-wrapper">

    <a href="{{ picture.original }}"
    data-responsive="{% for size in picture.sizes %} {{ site.url}}{{ site.baseurl }}/assets/photography/{{ include.gallery.picture_path }}/{{ size }} {{ size | split: '-' | last | split: '.' | first | split: 'x' | first | strip }}{% unless forloop.last %},{% endunless %}{% endfor %}" class="image"
    {% if picture.title %} data-sub-html="<div class='lg-toolbar caption'><h4>{{ picture.title | escape }}</h4>{% if picture.caption %}<p>{{ picture.caption | escape }}</p>{% endif %}</div>"{% endif %}>
      <img alt="{{ picture.title }}" src="{{ picture.thumbnail }}" />
    </a>

  </div>
  {% endfor %}

</div>

<!-- <script type="text/javascript">
  var $gallery{% if include.id_number %}{{ include.id_number }}{% endif %} = lightGallery(document.getElementById("#image-gallery{% if include.id_number %}-{{ include.id_number }}{% endif %}"), {});

</script> -->

<script type="text/javascript">

  //var eid = document.querySelector('image-gallery{% if include.id_number %}-{{ include.id_number }}{% endif %}');

  var elem = document.getElementById('image-gallery{% if include.id_number %}-{{ include.id_number }}{% endif %}');

  var grid{% if include.id_number %}{{ include.id_number }}{% endif %} = new Isotope(elem, {
    //'.' prepends css class
    itemSelector : '.image-wrapper',
    // percentPosition : true,
    // masonry: {
    //   columnWidth : 'gallery-sizer{% if include.id_number %}-{{ include.id_number }}{% endif %}'
    // }
  });

  function ilayoutWrapper()
  {
    grid{% if include.id_number %}{{ include.id_number }}{% endif %}.layout();
    console.log('loaded and layout refreshed');
  }

  //var imgWrappers = elem.querySelectorAll('.image-wrapper');
  var imgwrappers = elem.querySelectorAll('.image-wrapper');
  imgwrappers.forEach(function(imgwrapper){
    var img = imgwrapper.querySelector('img');
    console.log('attached');
    if(img.complete)
      ilayoutWrapper();
    else
      img.addEventListener('load', ilayoutWrapper);
  })

  // imagesLoaded(
  //   //document.getElementById('image-gallery{% if include.id_number %}-{{ include.id_number }}{% endif %}').querySelector('.image-wrapper'), 
  //   grid{% if include.id_number %}{{ include.id_number }}{% endif %}, 
  //   function(){
  //   console.log('imageloaded');
  //   grid{% if include.id_number %}{{ include.id_number }}{% endif %}.layout();
  // })

  


// var $gallery{% if include.id_number %}{{ include.id_number }}{% endif %} = lightGallery(document.getElementById("#image-gallery{% if include.id_number %}-{{ include.id_number }}{% endif %}"), {
//   thumbnail: false,
//   selector: '.image'
// });

// $(document).ready(function() {
// // $(function() {
//   var $gallery{% if include.id_number %}{{ include.id_number }}{% endif %} = $("#image-gallery{% if include.id_number %}-{{ include.id_number }}{% endif %}").lightGallery({
//     thumbnail: false,
//     selector: '.image'
//   });
// });

// init isotope
// var $grid{% if include.id_number %}{{ include.id_number }}{% endif %} = $('#image-gallery{% if include.id_number %}-{{ include.id_number }}{% endif %}').isotope({
//   percentPosition: true,
//   columnWidth: '#gallery-sizer{% if include.id_number %}-{{ include.id_number }}{% endif %}',
//   itemSelector: '.image-wrapper',
//   layoutMode: "masonry"
// });

// layout Isotope after each image loads
// $grid{% if include.id_number %}{{ include.id_number }}{% endif %}.imagesLoaded().progress( function() {
//   $grid{% if include.id_number %}{{ include.id_number }}{% endif %}.masonry();
// });

</script>
